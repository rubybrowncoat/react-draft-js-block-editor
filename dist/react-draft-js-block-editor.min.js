!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.DraftJsBlockEditor=e()}}(function(){return function e(t,n,o){function r(l,a){if(!n[l]){if(!t[l]){var u="function"==typeof require&&require;if(!a&&u)return u(l,!0);if(i)return i(l,!0);var s=new Error("Cannot find module '"+l+"'");throw s.code="MODULE_NOT_FOUND",s}var c=n[l]={exports:{}};t[l][0].call(c.exports,function(e){var n=t[l][1][e];return r(n?n:e)},c,c.exports,e,t,n,o)}return n[l].exports}for(var i="function"==typeof require&&require,l=0;l<o.length;l++)r(o[l]);return r}({1:[function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var r=e("./editor"),i=o(r),l=e("./util/beforeinput"),a=o(l),u=e("./model/rendermap"),s=o(u);n.Editor=i["default"],n.beforeInput=a["default"],n.StringToTypeMap=l.StringToTypeMap,n.RenderMap=s["default"]},{"./editor":12,"./model/rendermap":14,"./util/beforeinput":15}],2:[function(e,t,n){(function(o){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),u=function(e,t,n){for(var o=!0;o;){var r=e,i=t,l=n;o=!1,null===r&&(r=Function.prototype);var a=Object.getOwnPropertyDescriptor(r,i);if(void 0!==a){if("value"in a)return a.value;var u=a.get;if(void 0===u)return;return u.call(l)}var s=Object.getPrototypeOf(r);if(null===s)return;e=s,t=i,n=l,o=!0,a=s=void 0}},s="undefined"!=typeof window?window.React:"undefined"!=typeof o?o.React:null,c=r(s),d=e("../util"),f=function(e){function t(e){i(this,t),u(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.state={style:{},visible:!1},this.node=null,this.blockKey="",this.blockType="",this.blockLength=-1,this.findNode=this.findNode.bind(this),this.hideBlock=this.hideBlock.bind(this)}return l(t,e),a(t,[{key:"componentWillReceiveProps",value:function(e){var t=e.editorState,n=t.getCurrentContent(),o=t.getSelection();if(!o.isCollapsed()||o.anchorKey!=o.focusKey)return void this.hideBlock();var r=n.getBlockForKey(o.anchorKey),i=r.getKey();return r.getType()!==this.blockType?(this.blockType=r.getType(),void setTimeout(this.findNode,0)):this.blockKey===i?void this.setState({visible:!0}):(this.blockKey=i,void setTimeout(this.findNode,0))}},{key:"hideBlock",value:function(){this.state.visible&&this.setState({visible:!1})}},{key:"findNode",value:function(){var e=(0,d.getSelectedBlockNode)(window);if(e!==this.node){if(!e)return void this.setState({visible:!1});e.getBoundingClientRect();this.node=e,this.setState({visible:!0,style:{top:e.offsetTop}})}}},{key:"render",value:function(){return this.state.visible?c["default"].createElement("button",{onClick:this.props.addMedia,className:"add-button",style:this.state.style},"+"):null}}]),t}(c["default"].Component);n["default"]=f,t.exports=n["default"]}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../util":17}],3:[function(e,t,n){(function(o){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var i="undefined"!=typeof window?window.React:"undefined"!=typeof o?o.React:null,l=r(i),a=e("draft-js");n["default"]=function(e){var t=a.Entity.get(e.block.getEntityAt(0)),n=t.getData(),o=t.getType();return"image"===o?l["default"].createElement("div",{className:"block-atomic-wrapper"},l["default"].createElement("img",{src:n.src}),l["default"].createElement("div",{className:"block-atomic-controls"},l["default"].createElement("button",null,"×"))):l["default"].createElement("p",null,"No supported block for ",o)},t.exports=n["default"]}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"draft-js":void 0}],4:[function(e,t,n){(function(o){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var i="undefined"!=typeof window?window.React:"undefined"!=typeof o?o.React:null,l=r(i),a=e("draft-js");n["default"]=function(e){return l["default"].createElement("cite",null,l["default"].createElement(a.EditorBlock,e))},t.exports=n["default"]}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"draft-js":void 0}],5:[function(e,t,n){(function(o){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var i="undefined"!=typeof window?window.React:"undefined"!=typeof o?o.React:null,l=r(i),a=e("draft-js");n["default"]=function(e){return l["default"].createElement(a.EditorBlock,e)},t.exports=n["default"]}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"draft-js":void 0}],6:[function(e,t,n){(function(o){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var i="undefined"!=typeof window?window.React:"undefined"!=typeof o?o.React:null,l=r(i),a=e("draft-js"),u=e("./stylebutton"),s=r(u);n["default"]=function(e){var t=e.editorState,n=a.RichUtils.getCurrentBlockType(t);return l["default"].createElement("div",{className:"RichEditor-controls"},e.buttons.map(function(t){return l["default"].createElement(s["default"],{key:t.label,active:t.style===n,label:t.label,onToggle:e.onToggle,style:t.style})}))},t.exports=n["default"]}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./stylebutton":10,"draft-js":void 0}],7:[function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var r=e("./blocks/blockquotecaption"),i=o(r),l=e("./blocks/caption"),a=o(l),u=e("./blocks/atomic"),s=o(u);n["default"]=function(e){var t=e.getType();switch(t){case"block-quote-caption":return{component:i["default"]};case"caption":return{component:a["default"]};case"atomic":return{component:s["default"],editable:!1};default:return null}},t.exports=n["default"]},{"./blocks/atomic":3,"./blocks/blockquotecaption":4,"./blocks/caption":5}],8:[function(e,t,n){(function(t){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var r="undefined"!=typeof window?window.React:"undefined"!=typeof t?t.React:null,i=o(r),l=e("draft-js"),a=function(e,t){e.findEntityRanges(function(e){var t=e.getEntity();return null!==t&&"LINK"===l.Entity.get(t).getType()},t)};n.findLinkEntities=a,n["default"]=function(e){var t=l.Entity.get(e.entityKey).getData(),n=t.url;return i["default"].createElement("a",{className:"draft-link hint--bottom",href:n,target:"_blank"},e.children)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"draft-js":void 0}],9:[function(e,t,n){(function(o){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var i="undefined"!=typeof window?window.React:"undefined"!=typeof o?o.React:null,l=r(i),a=e("./stylebutton"),u=r(a);n["default"]=function(e){var t=e.editorState.getCurrentInlineStyle();return l["default"].createElement("div",{className:"RichEditor-controls"},e.buttons.map(function(n){return l["default"].createElement(u["default"],{key:n.style,active:t.has(n.style),label:n.label,onToggle:e.onToggle,style:n.style})}))},t.exports=n["default"]}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./stylebutton":10}],10:[function(e,t,n){(function(e){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=function(e,t,n){for(var o=!0;o;){var r=e,i=t,l=n;o=!1,null===r&&(r=Function.prototype);var a=Object.getOwnPropertyDescriptor(r,i);if(void 0!==a){if("value"in a)return a.value;var u=a.get;if(void 0===u)return;return u.call(l)}var s=Object.getPrototypeOf(r);if(null===s)return;e=s,t=i,n=l,o=!0,a=s=void 0}},u="undefined"!=typeof window?window.React:"undefined"!=typeof e?e.React:null,s=o(u),c=function(e){function t(){var e=this;r(this,t),a(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.onToggle=function(t){t.preventDefault(),e.props.onToggle(e.props.style)}}return i(t,e),l(t,[{key:"render",value:function(){var e="RichEditor-styleButton";return this.props.active&&(e+=" RichEditor-activeButton"),s["default"].createElement("span",{className:e,onMouseDown:this.onToggle},this.props.label)}}]),t}(s["default"].Component);n["default"]=c,t.exports=n["default"]}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],11:[function(e,t,n){(function(o){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),u=function(e,t,n){for(var o=!0;o;){var r=e,i=t,l=n;o=!1,null===r&&(r=Function.prototype);var a=Object.getOwnPropertyDescriptor(r,i);if(void 0!==a){if("value"in a)return a.value;var u=a.get;if(void 0===u)return;return u.call(l)}var s=Object.getPrototypeOf(r);if(null===s)return;e=s,t=i,n=l,o=!0,a=s=void 0}},s="undefined"!=typeof window?window.React:"undefined"!=typeof o?o.React:null,c=r(s),d=e("react-dom"),f=r(d),p=e("draft-js"),h=e("./blocktoolbar"),y=r(h),g=e("./inlinetoolbar"),v=r(g),b=e("../util/index"),w=e("../model/index");window.getVisibleSelectionRect=p.getVisibleSelectionRect;var m=function(e){function t(e){i(this,t),u(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.state={showURLInput:!1,urlInputValue:"",style:{top:0,left:0}},this.onKeyDown=this.onKeyDown.bind(this),this.onChange=this.onChange.bind(this),this.showLinkInput=this.showLinkInput.bind(this),this.hasDimension=!1,this.rect={},this.forceHide=!1}return l(t,e),a(t,[{key:"componentWillReceiveProps",value:function(e){var t=e.editorState;if(e.editorEnabled){var n=t.getSelection();if(n.isCollapsed())return void(this.state.showURLInput&&this.setState({showURLInput:!1}));var o=(0,b.getSelection)(window);if(o.rangeCount){var r=(o.getRangeAt(0).startContainer.parentNode,(0,b.getSelectionRect)(o)),i={element:document.getElementsByClassName("public-DraftEditor-content")[0].children[0]};i.rect=i.element.getBoundingClientRect();var l={element:document.body};if(l.rect=l.element.getBoundingClientRect(),this.hasDimension){var a=r.left-i.rect.left+(r.width-this.rect.width)/2;r.width>=i.rect.width&&(a=(i.rect.width-this.rect.width)/2),a=Math.max(Math.min(a,i.rect.width-this.rect.width),0),this.setState({style:{top:r.top-l.rect.top-this.rect.height-40,width:this.rect.width,left:a}})}else this.setState({style:{top:r.top-l.rect.top-95,left:Math.max(Math.min((r.left+r.width-341)/2,i.rect.width-this.rect.width),0),width:341}})}}}},{key:"componentDidUpdate",value:function(){this.forceHide=!1;var e=f["default"].findDOMNode(this);e&&(this.rect=f["default"].findDOMNode(this).getBoundingClientRect(),this.hasDimension=!0)}},{key:"onKeyDown",value:function(e){var t=this;13===e.which?(e.preventDefault(),e.stopPropagation(),this.props.setLink(this.state.urlInputValue),this.setState({showURLInput:!1,urlInputValue:""},function(){return t.props.focus()})):27===e.which&&(e.preventDefault(),e.stopPropagation(),this.setState({showURLInput:!1,urlInputValue:""},function(){return t.props.focus()}))}},{key:"onChange",value:function(e){this.setState({urlInputValue:e.target.value})}},{key:"showLinkInput",value:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];n||(e.preventDefault(),e.stopPropagation());var o=this.props.editorState,r=o.getSelection();if(r.isCollapsed())return void this.props.focus();var i=(0,w.getCurrentBlock)(o),l="",a=!1;i.findEntityRanges(function(e){var t=e.getEntity();return l=t,null!==t&&"LINK"===p.Entity.get(t).getType()},function(e,n){var o=r.getAnchorOffset(),i=r.getFocusOffset();if(r.getIsBackward()&&(o=r.getFocusOffset(),i=r.getAnchorOffset()),e==o&&n==i){a=!0;var u=p.Entity.get(l).getData(),s=u.url;t.setState({showURLInput:!0,urlInputValue:s},function(){setTimeout(function(){t.refs.urlinput.focus(),t.refs.urlinput.select()},0)})}}),a||this.setState({showURLInput:!0},function(){setTimeout(function(){t.refs.urlinput.focus()},0)})}},{key:"render",value:function(){var e=this.props,t=e.editorState,n=e.editorEnabled,o=this.state,r=o.showURLInput,i=o.urlInputValue,l=o.style;return!n||t.getSelection().isCollapsed()?null:r?c["default"].createElement("div",{className:"editor-toolbar",style:l},c["default"].createElement("div",{className:"RichEditor-controls",style:{display:"block"}},c["default"].createElement("input",{ref:"urlinput",type:"text",className:"url-input",onKeyDown:this.onKeyDown,onChange:this.onChange,placeholder:"Press ENTER or ESC",value:i}))):c["default"].createElement("div",{className:"editor-toolbar",style:l},c["default"].createElement(y["default"],{editorState:t,onToggle:this.props.toggleBlockType,buttons:k}),c["default"].createElement(v["default"],{editorState:t,onToggle:this.props.toggleInlineStyle,buttons:E}),c["default"].createElement("div",{className:"RichEditor-controls"},c["default"].createElement("a",{className:"RichEditor-linkButton",href:"#",onClick:this.showLinkInput},"#")))}}]),t}(c["default"].Component);n["default"]=m;var k=[{label:"T",style:"header-three"},{label:"N",style:"unstyled"},{label:"Q",style:"blockquote"},{label:"UL",style:"unordered-list-item"},{label:"OL",style:"ordered-list-item"}],E=[{label:c["default"].createElement("b",null,"B"),style:"BOLD"},{label:c["default"].createElement("i",null,"I"),style:"ITALIC"},{label:c["default"].createElement("u",null,"U"),style:"UNDERLINE"},{label:c["default"].createElement("strike",null,"S"),style:"STRIKETHROUGH"},{label:"Hi",style:"HIGHLIGHT"}];t.exports=n["default"]}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../model/index":13,"../util/index":17,"./blocktoolbar":6,"./inlinetoolbar":9,"draft-js":void 0,"react-dom":void 0}],12:[function(e,t,n){(function(o){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e){switch(e.getType()){case"blockquote":return"block block-quote RichEditor-blockquote";case"unstyled":return"block block-paragraph";case"atomic":return"block block-atomic";case"caption":return"block block-caption";case"block-quote-caption":return"block block-quote RichEditor-blockquote block-quote-caption";default:return"block"}}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=function(e,t,n){for(var o=!0;o;){var r=e,i=t,l=n;o=!1,null===r&&(r=Function.prototype);var a=Object.getOwnPropertyDescriptor(r,i);if(void 0!==a){if("value"in a)return a.value;var u=a.get;if(void 0===u)return;return u.call(l)}var s=Object.getPrototypeOf(r);if(null===s)return;e=s,t=i,n=l,o=!0,a=s=void 0}},c="undefined"!=typeof window?window.React:"undefined"!=typeof o?o.React:null,d=r(c),f=e("draft-js"),p=e("immutable"),h=e("./components/addbutton"),y=r(h),g=e("./components/toolbar"),v=r(g),b=e("./components/customrenderer"),w=r(b),m=(e("./util"),e("./model/rendermap")),k=r(m),E=e("./util/keybinding"),T=r(E),S=e("./util/exporter"),O=r(S),_=e("./util/beforeinput"),C=r(_),R=e("./model"),B=e("./components/entities/link"),I=r(B),j={HIGHLIGHT:{backgroundColor:"yellow"},CODE:{fontFamily:'Consolas, "Liberation Mono", Menlo, Courier, monospace',margin:"4px 0",fontSize:"0.9em",padding:"1px 3px",color:"#555",backgroundColor:"#fcfcfc",border:"1px solid #ccc",borderBottomColor:"#bbb",borderRadius:3,boxShadow:"inset 0 -1px 0 #bbb"}},L=function(e){function t(e){var n=this;i(this,t),s(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e);var o=new f.CompositeDecorator([{strategy:B.findLinkEntities,component:I["default"]}]);this.state={editorState:f.EditorState.createEmpty(o),showURLInput:!1,editorEnabled:!0,urlValue:""},e.value&&(this.state.editorState=f.EditorState.push(this.state.editorState,(0,f.convertFromRaw)(e.value))),this.focus=function(){return n.refs.editor.focus()},this.onChange=function(e){window.editorState=e,n.setState({editorState:e})},this.onClick=function(){n.state.editorEnabled||n.setState({editorEnabled:!0},function(){n.focus()})},this.logData=this.logData.bind(this),this.onClick=this.onClick.bind(this),this.onTab=this.onTab.bind(this),this.handleKeyCommand=this.handleKeyCommand.bind(this),this.handleBeforeInput=this.handleBeforeInput.bind(this),this.handleReturn=this.handleReturn.bind(this),this.toggleBlockType=this._toggleBlockType.bind(this),this.toggleInlineStyle=this._toggleInlineStyle.bind(this),this.toggleEdit=this.toggleEdit.bind(this),this.loadSavedData=this.loadSavedData.bind(this),this.setLink=this.setLink.bind(this),this.addMedia=this.addMedia.bind(this)}return l(t,e),u(t,[{key:"componentDidMount",value:function(){this.focus()}},{key:"onTab",value:function(e){var t=this.state.editorState,n=f.RichUtils.onTab(e,t,2);n!==t&&this.onChange(n)}},{key:"logData",value:function(e){console.log("HTML",(0,O["default"])(this.state.editorState.getCurrentContent())),console.log((0,f.convertToRaw)(this.state.editorState.getCurrentContent())),console.log(this.state.editorState.getSelection().toJS()),window.sel=this.state.editorState.getSelection()}},{key:"setLink",value:function(e){var t=this,n=this.state.editorState,o=n.getSelection(),r=null;""!==e&&(r=f.Entity.create("LINK","MUTABLE",{url:e})),this.setState({editorState:f.RichUtils.toggleLink(n,o,r)},function(){setTimeout(function(){return t.refs.editor.focus()},0)})}},{key:"addMedia",value:function(){var e=window.prompt("Enter a URL");if(e){var t=f.Entity.create("image","IMMUTABLE",{src:e});this.onChange(f.AtomicBlockUtils.insertAtomicBlock(this.state.editorState,t," "))}}},{key:"handleDroppedFiles",value:function(e,t){console.log(e.toJS()),console.log(t)}},{key:"handleKeyCommand",value:function(e){if("editor-save"===e)return window.localStorage.editor=JSON.stringify((0,f.convertToRaw)(this.state.editorState.getCurrentContent())),window.localStorage.tmp=JSON.stringify((0,f.convertToRaw)(this.state.editorState.getCurrentContent())),!0;if("showlinkinput"===e)return this.refs.toolbar&&this.refs.toolbar.showLinkInput(null,!0),!0;if("add-new-block"===e){var t=this.state.editorState;return this.onChange((0,R.addNewBlock)(t,"blockquote")),!0}if("load-saved-data"===e)return this.loadSavedData(),!0;var n=this.state.editorState,o=(0,R.getCurrentBlock)(n);if(0==e.indexOf("changetype:")){var r=e.split(":")[1],i=o.getType();return"atomic"==i||"media"==i?!1:("blockquote"==i&&"caption"==r?r="block-quote-caption":"block-quote-caption"==i&&"caption"==r&&(r="blockquote"),this.onChange(f.RichUtils.toggleBlockType(n,r)),!0)}var l=f.RichUtils.handleKeyCommand(n,e);return l?(this.onChange(l),!0):!1}},{key:"handleBeforeInput",value:function(e){return this.props.beforeInput(this.state.editorState,e,this.onChange,this.props.stringToTypeMap)}},{key:"handleReturn",value:function(e){return e.shiftKey?(this.setState({editorState:f.RichUtils.insertSoftNewline(this.state.editorState)}),!0):!1}},{key:"_toggleBlockType",value:function(e){this.onChange(f.RichUtils.toggleBlockType(this.state.editorState,e))}},{key:"_toggleInlineStyle",value:function(e){this.onChange(f.RichUtils.toggleInlineStyle(this.state.editorState,e))}},{key:"toggleEdit",value:function(e){this.setState({editorEnabled:!this.state.editorEnabled})}},{key:"loadSavedData",value:function(){var e=this,t=window.localStorage.getItem("editor");if(null===t)return void console.log("No data found.");try{var n=JSON.parse(t);console.log(n),this.setState({editorState:f.EditorState.push(this.state.editorState,(0,f.convertFromRaw)(n))},function(){return e.refs.editor.focus()})}catch(o){window.er=o,console.log(o),console.log("Could not load data.")}}},{key:"render",value:function(){var e=this.state,t=e.editorState,n=(e.showURLInput,e.editorEnabled);e.urlValue;return d["default"].createElement("div",{className:"RichEditor-root"},d["default"].createElement("div",{className:"RichEditor-editor"},d["default"].createElement(f.Editor,{ref:"editor",editorState:t,blockRendererFn:w["default"],blockStyleFn:a,onChange:this.onChange,onTab:this.onTab,blockRenderMap:this.props.blockRenderMap,handleKeyCommand:this.handleKeyCommand,handleBeforeInput:this.handleBeforeInput,handleDroppedFiles:this.handleDroppedFiles,handleReturn:this.handleReturn,customStyleMap:j,readOnly:!n,keyBindingFn:T["default"],placeholder:"Write your story",spellCheck:!1}),n?d["default"].createElement(y["default"],{editorState:t,addMedia:this.addMedia}):null,d["default"].createElement(v["default"],{ref:"toolbar",editorState:t,toggleBlockType:this.toggleBlockType,toggleInlineStyle:this.toggleInlineStyle,editorEnabled:n,setLink:this.setLink,focus:this.focus})),d["default"].createElement("div",{className:"editor-action"},d["default"].createElement("button",{onClick:this.logData},"Log State"),d["default"].createElement("button",{onClick:this.toggleEdit},"Toggle Edit")))}}]),t}(d["default"].Component);(0,p.Map)();L.defaultProps={beforeInput:C["default"],stringToTypeMap:_.StringToTypeMap,blockRenderMap:k["default"]},n["default"]=L,t.exports=n["default"]}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./components/addbutton":2,"./components/customrenderer":7,"./components/entities/link":8,"./components/toolbar":11,"./model":13,"./model/rendermap":14,"./util":17,"./util/beforeinput":15,"./util/exporter":16,"./util/keybinding":18,"draft-js":void 0,immutable:void 0}],13:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=e("draft-js"),r=function(e){var t=e.getSelection(),n=e.getCurrentContent(),o=n.getBlockForKey(t.getStartKey());return o};n.getCurrentBlock=r;var i=function(e){var t=arguments.length<=1||void 0===arguments[1]?"unstyled":arguments[1],n=e.getSelection();if(!n.isCollapsed())return console.log("selection not collapsed"),e;var i=e.getCurrentContent(),l=n.getStartKey(),a=i.getBlockMap(),u=r(e);if(!u)return console.log("no current block"),e;if(0==u.getLength()){if(u.getType()==t)return console.log("same block types"),e;var s=u.merge({type:t}),c=i.merge({blockMap:a.set(l,s),selectionAfter:n});return o.EditorState.push(e,c,"change-block-type")}return console.log("block length > 0"),e};n.addNewBlock=i;var l=function(e){var t=arguments.length<=1||void 0===arguments[1]?"unstyled":arguments[1],n=e.getCurrentContent(),r=e.getSelection(),i=r.getStartKey(),l=n.getBlockMap(),a=l.get(i),u="",s=a.getText();a.getLength()>=2&&(u=s.substr(1));var c=a.merge({text:u,type:t}),d=n.merge({blockMap:l.set(i,c),selectionAfter:r.merge({anchorOffset:0,focusOffset:0})});return o.EditorState.push(e,d,"change-block-type")};n.resetBlockWithType=l},{"draft-js":void 0}],14:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=e("immutable"),r=e("draft-js"),i=(0,o.Map)({unstyled:{element:"div"},caption:{element:"cite"},"block-quote-caption":{element:"blockquote"}}).merge(r.DefaultDraftBlockRenderMap);n["default"]=i,t.exports=n["default"]},{"draft-js":void 0,immutable:void 0}],15:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=e("../model/index"),r=e("ramda"),i=(0,r.addIndex)(r.forEach),l={"--":"blockquote:block-quote-caption:caption","//":"blockquote",'""':"blockquote","''":"blockquote","*.":"unordered-list-item","1.":"ordered-list-item","##":"header-two","==":"unstyled"};n.StringToTypeMap=l,n["default"]=function(e,t,n){var a=arguments.length<=3||void 0===arguments[3]?l:arguments[3],u=e.getSelection(),s=(0,o.getCurrentBlock)(e),c=s.getType(),d=s.getLength();if(console.log(t,c,d),console.log(s.getText()[0]+t),u.getAnchorOffset()>1||d>1)return!1;var f=a[s.getText()[0]+t];if(!f)return!1;var p=f.split(":");if(p.length<1||p.length>3)return!1;var h=p[0];return c===(0,r.last)(p)?!1:(h=(0,r.last)(p),i(function(e,t,n){c===e&&(h=n[t+1])},(0,r.dropLast)(1,p)),console.log(h),n((0,o.resetBlockWithType)(e,h)),!0)}},{"../model/index":13,ramda:void 0}],16:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e){switch(e){case v.BLOCK_TYPE.HEADER_ONE:return["h1"];case v.BLOCK_TYPE.HEADER_TWO:return["h2"];case v.BLOCK_TYPE.HEADER_THREE:return["h3"];case v.BLOCK_TYPE.HEADER_FOUR:return["h4"];case v.BLOCK_TYPE.HEADER_FIVE:return["h5"];case v.BLOCK_TYPE.HEADER_SIX:return["h6"];case v.BLOCK_TYPE.UNORDERED_LIST_ITEM:case v.BLOCK_TYPE.ORDERED_LIST_ITEM:return["li"];case v.BLOCK_TYPE.BLOCKQUOTE:return["blockquote"];case v.BLOCK_TYPE.CODE:return["pre","code"];default:return["p"]}}function l(e){switch(e){case v.BLOCK_TYPE.UNORDERED_LIST_ITEM:return"ul";case v.BLOCK_TYPE.ORDERED_LIST_ITEM:return"ol";default:return null}}function a(e){if(null==e)return"";var t=[],n=!0,o=!1,r=void 0;try{for(var i,l=Object.keys(e)[Symbol.iterator]();!(n=(i=l.next()).done);n=!0){var a=i.value,u=e[a];null!=u&&t.push(" "+a+'="'+c(u+"")+'"')}}catch(s){o=!0,r=s}finally{try{!n&&l["return"]&&l["return"]()}finally{if(o)throw r}}return t.join("")}function u(e){switch(e){case v.BLOCK_TYPE.UNORDERED_LIST_ITEM:case v.BLOCK_TYPE.ORDERED_LIST_ITEM:return!0;default:return!1}}function s(e){return e.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;").split(" ").join("&nbsp;").split("\n").join(S+"\n")}function c(e){return e.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;").split('"').join("&quot;")}function d(e){return new C(e).generate()}Object.defineProperty(n,"__esModule",{value:!0});var f,p,h=function(){function e(e,t){var n=[],o=!0,r=!1,i=void 0;try{for(var l,a=e[Symbol.iterator]();!(o=(l=a.next()).done)&&(n.push(l.value),!t||n.length!==t);o=!0);}catch(u){r=!0,i=u}finally{try{!o&&a["return"]&&a["return"]()}finally{if(r)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),y=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();n["default"]=d;var g=e("draft-js"),v=e("draft-js-utils"),b=v.INLINE_STYLE.BOLD,w=v.INLINE_STYLE.CODE,m=v.INLINE_STYLE.ITALIC,k=v.INLINE_STYLE.STRIKETHROUGH,E=v.INLINE_STYLE.UNDERLINE,T="  ",S="<br>",O=(f={},r(f,v.ENTITY_TYPE.LINK,{url:"href",rel:"rel",target:"target",title:"title",className:"class"}),r(f,v.ENTITY_TYPE.IMAGE,{src:"src",height:"height",width:"width",alt:"alt",className:"class"}),f),_=(p={},r(p,v.ENTITY_TYPE.LINK,function(e,t){var n=O.hasOwnProperty(e)?O[e]:{},o=t.getData(),r={},i=!0,l=!1,a=void 0;try{for(var u,s=Object.keys(o)[Symbol.iterator]();!(i=(u=s.next()).done);i=!0){var c=u.value,d=o[c];if(n.hasOwnProperty(c)){var f=n[c];r[f]=d}}}catch(p){l=!0,a=p}finally{try{!i&&s["return"]&&s["return"]()}finally{if(l)throw a}}return r}),r(p,v.ENTITY_TYPE.IMAGE,function(e,t){var n=O.hasOwnProperty(e)?O[e]:{},o=t.getData(),r={},i=!0,l=!1,a=void 0;try{for(var u,s=Object.keys(o)[Symbol.iterator]();!(i=(u=s.next()).done);i=!0){var c=u.value,d=o[c];if(n.hasOwnProperty(c)){var f=n[c];r[f]=d}}}catch(p){l=!0,a=p}finally{try{!i&&s["return"]&&s["return"]()}finally{if(l)throw a}}return r}),p),C=function(){function e(t){o(this,e),this.contentState=t}return y(e,[{key:"generate",value:function(){for(this.output=[],this.blocks=this.contentState.getBlocksAsArray(),this.totalBlocks=this.blocks.length,this.currentBlock=0,this.indentLevel=0,this.wrapperTag=null;this.currentBlock<this.totalBlocks;)this.processBlock();return this.closeWrapperTag(),this.output.join("").trim()}},{key:"processBlock",value:function(){var e=this.blocks[this.currentBlock],t=e.getType(),n=l(t);this.wrapperTag!==n&&(this.wrapperTag&&this.closeWrapperTag(),n&&this.openWrapperTag(n)),this.indent(),this.writeStartTag(t),this.output.push(this.renderBlockContent(e));var o=this.getNextBlock();if(u(t)&&o&&o.getDepth()===e.getDepth()+1){this.output.push("\n");var r=this.wrapperTag;this.wrapperTag=null,this.indentLevel+=1,this.currentBlock+=1,this.processBlocksAtDepth(o.getDepth()),this.wrapperTag=r,this.indentLevel-=1,this.indent()}else this.currentBlock+=1;this.writeEndTag(t)}},{key:"processBlocksAtDepth",value:function(e){for(var t=this.blocks[this.currentBlock];t&&t.getDepth()===e;)this.processBlock(),t=this.blocks[this.currentBlock];this.closeWrapperTag()}},{key:"getNextBlock",value:function(){return this.blocks[this.currentBlock+1]}},{key:"writeStartTag",value:function(e){var t=i(e),n=!0,o=!1,r=void 0;try{for(var l,a=t[Symbol.iterator]();!(n=(l=a.next()).done);n=!0){var u=l.value;this.output.push("<"+u+">")}}catch(s){o=!0,r=s}finally{try{!n&&a["return"]&&a["return"]()}finally{if(o)throw r}}}},{key:"writeEndTag",value:function(e){var t=i(e);if(1===t.length)this.output.push("</"+t[0]+">\n");else{var n=[],o=!0,r=!1,l=void 0;try{for(var a,u=t[Symbol.iterator]();!(o=(a=u.next()).done);o=!0){var s=a.value;n.unshift("</"+s+">");
}}catch(c){r=!0,l=c}finally{try{!o&&u["return"]&&u["return"]()}finally{if(r)throw l}}this.output.push(n.join("")+"\n")}}},{key:"openWrapperTag",value:function(e){this.wrapperTag=e,this.indent(),this.output.push("<"+e+">\n"),this.indentLevel+=1}},{key:"closeWrapperTag",value:function(){this.wrapperTag&&(this.indentLevel-=1,this.indent(),this.output.push("</"+this.wrapperTag+">\n"),this.wrapperTag=null)}},{key:"indent",value:function(){this.output.push(T.repeat(this.indentLevel))}},{key:"renderBlockContent",value:function(e){var t=e.getType(),n=e.getText();if(""===n)return S;n=this.preserveWhitespace(n);var o=e.getCharacterList(),r=(0,v.getEntityRanges)(n,o);return r.map(function(e){var n=h(e,2),o=n[0],r=n[1],i=r.map(function(e){var n=h(e,2),o=n[0],r=n[1],i=s(o);return r.has(b)&&(i="<strong>"+i+"</strong>"),r.has(E)&&(i="<ins>"+i+"</ins>"),r.has(m)&&(i="<em>"+i+"</em>"),r.has(k)&&(i="<del>"+i+"</del>"),r.has(w)&&(i=t===v.BLOCK_TYPE.CODE?i:"<code>"+i+"</code>"),i}).join(""),l=o?g.Entity.get(o):null,u=null==l?null:l.getType().toUpperCase();if(null!=u&&u===v.ENTITY_TYPE.LINK){var c=_.hasOwnProperty(u)?_[u](u,l):null,d=a(c);return"<a"+d+">"+i+"</a>"}if(null!=u&&u===v.ENTITY_TYPE.IMAGE){var c=_.hasOwnProperty(u)?_[u](u,l):null,d=a(c);return"<img"+d+"/>"}return i}).join("")}},{key:"preserveWhitespace",value:function(e){for(var t=e.length,n=new Array(t),o=0;t>o;o++)" "!==e[o]||0!==o&&o!==t-1&&" "!==e[o-1]?n[o]=e[o]:n[o]=" ";return n.join("")}}]),e}();t.exports=n["default"]},{"draft-js":void 0,"draft-js-utils":void 0}],17:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=function(e){var t=e.getRangeAt(0).getBoundingClientRect(),n=t&&t.top?t:e.getRangeAt(0).getClientRects()[0];if(!n){if(!e.anchorNode||!e.anchorNode.getBoundingClientRect)return null;n=e.anchorNode.getBoundingClientRect(),n.isEmptyline=!0}return n};n.getSelectionRect=o;var r=function(e){var t=null;return e.getSelection?t=e.getSelection():e.document.getSelection?t=e.document.getSelection():e.document.selection&&(t=e.document.selection.createRange().text),t};n.getSelection=r;var i=function(e){var t=e.getSelection();if(0==t.rangeCount)return null;window.sel=t;var n=t.getRangeAt(0).startContainer;do{if(n.getAttribute&&"true"===n.getAttribute("data-block"))return n;n=n.parentNode}while(null!==n);return null};n.getSelectedBlockNode=i},{}],18:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=e("draft-js"),r=o.KeyBindingUtil.hasCommandModifier;n["default"]=function(e){if(r(e)&&83==e.keyCode)return"editor-save";if(e.altKey===!0){if(e.shiftKey===!0)switch(e.keyCode){case 65:return"add-new-block";case 68:return"load-saved-data";case 69:return"toggle-edit-mode";default:return(0,o.getDefaultKeyBinding)(e)}switch(e.keyCode){case 49:return"changetype:ordered-list-item";case 50:return"showlinkinput";case 51:return"changetype:header-three";case 56:return"changetype:unordered-list-item";case 188:return"changetype:caption";case 190:return"changetype:unstyled";case 222:return"changetype:blockquote";default:return(0,o.getDefaultKeyBinding)(e)}}return(0,o.getDefaultKeyBinding)(e)},t.exports=n["default"]},{"draft-js":void 0}]},{},[1])(1)});